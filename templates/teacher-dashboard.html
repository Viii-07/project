<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Dashboard - SmartAttend</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: 'hsl(221, 83%, 53%)',
                        'primary-foreground': 'hsl(210, 40%, 98%)',
                        secondary: 'hsl(210, 40%, 96%)',
                        'secondary-foreground': 'hsl(222.2, 84%, 4.9%)',
                        muted: 'hsl(210, 40%, 96%)',
                        'muted-foreground': 'hsl(215.4, 16.3%, 46.9%)',
                        accent: 'hsl(210, 40%, 96%)',
                        'accent-foreground': 'hsl(222.2, 84%, 4.9%)',
                        destructive: 'hsl(0, 84%, 60%)',
                        'destructive-foreground': 'hsl(210, 40%, 98%)',
                        border: 'hsl(214.3, 31.8%, 91.4%)',
                        input: 'hsl(214.3, 31.8%, 91.4%)',
                        ring: 'hsl(221, 83%, 53%)',
                        background: 'hsl(0, 0%, 100%)',
                        foreground: 'hsl(222.2, 84%, 4.9%)',
                        card: 'hsl(0, 0%, 100%)',
                        'card-foreground': 'hsl(222.2, 84%, 4.9%)',
                        success: 'hsl(142, 76%, 36%)',
                        warning: 'hsl(38, 92%, 50%)'
                    },
                    backgroundImage: {
                        'gradient-primary': 'linear-gradient(135deg, hsl(221, 83%, 53%), hsl(221, 83%, 63%))',
                        'gradient-hero': 'linear-gradient(135deg, hsl(221, 83%, 53%) 0%, hsl(221, 83%, 63%) 100%)'
                    },
                    boxShadow: {
                        'elegant': '0 10px 30px -10px hsl(221, 83%, 53%, 0.3)',
                        'card': '0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1)'
                    }
                }
            }
        }
    </script>
</head>
<body class="min-h-screen bg-background">
    <!-- Navigation -->
    <nav class="bg-card border-b shadow-card">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="h-10 w-10 bg-gradient-primary rounded-lg flex items-center justify-center text-primary-foreground font-bold text-lg">
                        SA
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-primary">SmartAttend</h1>
                        <p class="text-xs text-muted-foreground">Teacher Dashboard</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <div class="text-right">
                        <p class="font-medium text-foreground" id="teacherName">Dr. Sarah Johnson</p>
                        <p class="text-sm text-muted-foreground">Teacher</p>
                    </div>
                    <button onclick="logout()" class="text-muted-foreground hover:text-foreground transition-colors">
                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-4 py-8">
        <!-- Welcome Section -->
        <div class="mb-8">
            <h2 class="text-3xl font-bold text-foreground mb-2">Welcome back!</h2>
            <p class="text-muted-foreground">Ready to take attendance for your classes?</p>
        </div>

        <!-- Current Time Display -->
        <div class="bg-card p-6 rounded-xl shadow-card mb-8">
            <div class="flex items-center gap-4">
                <div class="h-12 w-12 bg-gradient-primary rounded-lg flex items-center justify-center text-primary-foreground">
                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <div>
                    <p class="text-sm text-muted-foreground">Current Time</p>
                    <p class="text-2xl font-bold text-foreground" id="currentTime"></p>
                    <p class="text-sm text-muted-foreground" id="currentDate"></p>
                </div>
            </div>
        </div>

        <!-- Daily Schedule (7 Periods) -->
        <div class="bg-card rounded-xl shadow-card p-8 mb-8">
            <div class="mb-6">
                <h3 class="text-2xl font-bold text-foreground mb-2">Daily Schedule</h3>
                <p class="text-muted-foreground">Click on active periods to take attendance</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="periodsContainer">
                <!-- Periods will be dynamically generated -->
            </div>
        </div>

        <!-- Teacher ID Select (Above Attendance Form) -->
        <div class="mb-4">
            <label for="teacherId" class="block text-sm font-medium text-foreground mb-2">Teacher ID</label>
            <select id="teacherId" name="teacherId" class="w-full px-4 py-3 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all" required>
                <option value="">Select Teacher ID</option>
                <option value="T001">T001</option>
                <option value="T002">T002</option>
                <option value="T003">T003</option>
                <option value="T004">T004</option>
                <option value="T005">T005</option>
            </select>
        </div>

        <!-- Attendance Form -->
        <div class="bg-card rounded-xl shadow-card p-8">
            <div class="mb-6">
                <h3 class="text-2xl font-bold text-foreground mb-2">Start Attendance Session</h3>
                <p class="text-muted-foreground">Fill in the details to begin taking attendance</p>
            </div>

            <form id="attendanceForm" class="space-y-6">
                <!-- Department -->
                <div>
                    <label for="department" class="block text-sm font-medium text-foreground mb-2">Department</label>
                    <select id="department" name="department" class="w-full px-4 py-3 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all" required>
                        <option value="">Select Department</option>
                        <option value="Computer Science">Computer Science</option>
                        <option value="Electronics">Electronics & Communication</option>
                        <option value="Mechanical">Mechanical Engineering</option>
                        <option value="Civil">Civil Engineering</option>
                        <option value="Mathematics">Mathematics</option>
                        <option value="Physics">Physics</option>
                        <option value="Chemistry">Chemistry</option>
                    </select>
                </div>

                <!-- Class and Section -->
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <label for="className" class="block text-sm font-medium text-foreground mb-2">Class</label>
                        <select id="className" name="className" class="w-full px-4 py-3 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all" required>
                            <option value="">Select Class</option>
                            <option value="1st Year">1st Year</option>
                            <option value="2nd Year">2nd Year</option>
                            <option value="3rd Year">3rd Year</option>
                            <option value="4th Year">4th Year</option>
                        </select>
                    </div>
                    <div>
                        <label for="section" class="block text-sm font-medium text-foreground mb-2">Section</label>
                        <select id="section" name="section" class="w-full px-4 py-3 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all" required>
                            <option value="">Select Section</option>
                            <option value="A">Section A</option>
                            <option value="B">Section B</option>
                            <option value="C">Section C</option>
                            <option value="D">Section D</option>
                        </select>
                    </div>
                </div>

                <!-- Teacher Name (Auto-filled) -->
                <div>
                    <label for="teacherNameInput" class="block text-sm font-medium text-foreground mb-2">Teacher Name</label>
                    <input 
                        type="text" 
                        id="teacherNameInput" 
                        name="teacherName"
                        class="w-full px-4 py-3 border border-border rounded-lg bg-muted text-muted-foreground cursor-not-allowed"
                        value="Dr. Sarah Johnson"
                        readonly
                    >
                </div>

                <!-- Period -->
                <div>
                    <label for="period" class="block text-sm font-medium text-foreground mb-2">Period</label>
                    <select id="period" name="period" class="w-full px-4 py-3 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all" required>
                        <option value="">Select Period</option>
                        <option value="1">Period 1 (9:00 AM - 10:00 AM)</option>
                        <option value="2">Period 2 (10:00 AM - 11:00 AM)</option>
                        <option value="3">Period 3 (11:15 AM - 12:15 PM)</option>
                        <option value="4">Period 4 (12:15 PM - 1:15 PM)</option>
                        <option value="5">Period 5 (2:00 PM - 3:00 PM)</option>
                        <option value="6">Period 6 (3:00 PM - 4:00 PM)</option>
                        <option value="7">Period 7 (4:00 PM - 5:00 PM)</option>
                    </select>
                </div>

                <!-- Attendance Mode -->
                <div>
                    <label class="block text-sm font-medium text-foreground mb-3">Attendance Mode</label>
                    <div class="grid grid-cols-2 gap-4">
                        <label class="relative cursor-pointer">
                            <input type="radio" name="attendanceMode" value="presentees" class="sr-only peer" checked>
                            <div class="p-4 border-2 border-border rounded-lg transition-all peer-checked:border-primary peer-checked:bg-primary/5">
                                <div class="flex items-center gap-3">
                                    <div class="h-10 w-10 bg-success/20 rounded-lg flex items-center justify-center text-success">
                                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <h4 class="font-medium text-foreground">Mark Presentees</h4>
                                        <p class="text-sm text-muted-foreground">Check students who are present</p>
                                    </div>
                                </div>
                            </div>
                        </label>
                        <label class="relative cursor-pointer">
                            <input type="radio" name="attendanceMode" value="absentees" class="sr-only peer">
                            <div class="p-4 border-2 border-border rounded-lg transition-all peer-checked:border-primary peer-checked:bg-primary/5">
                                <div class="flex items-center gap-3">
                                    <div class="h-10 w-10 bg-destructive/20 rounded-lg flex items-center justify-center text-destructive">
                                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <h4 class="font-medium text-foreground">Mark Absentees</h4>
                                        <p class="text-sm text-muted-foreground">Check students who are absent</p>
                                    </div>
                                </div>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Submit Button -->
                <button 
                    type="submit" 
                    class="w-full bg-gradient-primary text-primary-foreground py-4 rounded-lg font-semibold text-lg shadow-elegant hover:shadow-lg transition-all duration-300 hover:scale-105"
                >
                    Start Taking Attendance
                </button>
            </form>
        </div>

        <!-- Recent Activity -->
        <div class="mt-8 bg-card rounded-xl shadow-card p-8">
            <h3 class="text-xl font-bold text-foreground mb-6">Recent Attendance Sessions</h3>
            <div class="space-y-4" id="recentSessions">
                <div class="flex items-center justify-between p-4 bg-muted rounded-lg">
                    <div>
                        <p class="font-medium text-foreground">Computer Science - 3rd Year A</p>
                        <p class="text-sm text-muted-foreground">Period 3 • Today 11:30 AM</p>
                    </div>
                    <div class="text-right">
                        <p class="text-sm text-success font-medium">42/45 Present</p>
                        <p class="text-xs text-muted-foreground">93% Attendance</p>
                    </div>
                </div>
                <div class="flex items-center justify-between p-4 bg-muted rounded-lg">
                    <div>
                        <p class="font-medium text-foreground">Computer Science - 2nd Year B</p>
                        <p class="text-sm text-muted-foreground">Period 1 • Today 9:15 AM</p>
                    </div>
                    <div class="text-right">
                        <p class="text-sm text-success font-medium">38/40 Present</p>
                        <p class="text-xs text-muted-foreground">95% Attendance</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Update current time
        function updateTime() {
            const now = new Date();
            const timeOptions = { 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit',
                hour12: true 
            };
            const dateOptions = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('en-US', timeOptions);
            document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', dateOptions);
        }

        // Daily Schedule
        const dailySchedule = [
            { period: 1, time: "9:00-10:00", subject: "Data Structures", class: "CS 2nd Year A", active: true },
            { period: 3, time: "11:00-12:00", subject: "Algorithms", class: "CS 3rd Year B", active: true },
            { period: 4, time: "12:00-1:00", subject: "Database Systems", class: "CS 2nd Year B", active: true },
            { period: 6, time: "3:00-4:00", subject: "Software Engineering", class: "CS 4th Year A", active: true },
            { period: 7, time: "4:00-5:00", subject: "Web Development", class: "CS 3rd Year A", active: true }
        ];

        // Generate daily schedule
        function generateDailySchedule() {
            const container = document.getElementById('periodsContainer');
            container.innerHTML = '';
            
            dailySchedule.forEach(period => {
                const periodCard = document.createElement('div');
                periodCard.className = `p-4 rounded-lg border transition-all cursor-pointer ${
                    period.active 
                        ? 'border-primary bg-primary/5 hover:bg-primary/10' 
                        : 'border-muted-foreground/20 bg-muted/50 cursor-not-allowed opacity-60'
                }`;
                
                periodCard.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="font-medium text-foreground">Period ${period.period}</h3>
                        <span class="text-muted-foreground text-sm">${period.time}</span>
                    </div>
                    <p class="text-foreground text-sm mb-2">${period.subject}</p>
                    <p class="text-muted-foreground text-xs mb-3">${period.class}</p>
                    ${period.active ? 
                        `<button onclick="startAttendance(${period.period})" class="w-full bg-gradient-primary text-primary-foreground py-2 px-4 rounded text-sm font-medium transition-all hover:shadow-lg">Take Attendance</button>` :
                        `<div class="w-full bg-muted text-muted-foreground py-2 px-4 rounded text-sm text-center font-medium">Free Period</div>`
                    }
                `;
                
                if (!period.active) {
                    periodCard.onclick = () => {
                        alert('Free period – attendance not required.');
                    };
                }
                
                container.appendChild(periodCard);
            });
        }

        // Start attendance for a specific period
        function startAttendance(periodNumber) {
            const isFree = confirm('Is this a free period? Click OK for Free, Cancel for Not Free.');
            if (isFree) {
                alert('Free period – attendance not required.');
                return;
            }
            // Redirect to attendance stats page for selected period
            window.location.href = '/attendance';
        }

        // Update time every second
        updateTime();
        setInterval(updateTime, 1000);

        // Check authentication
        function checkAuth() {
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            if (!user.role || user.role !== 'teacher') {
                window.location.href = 'login.html';
                return false;
            }
            document.getElementById('teacherName').textContent = user.name;
            document.getElementById('teacherNameInput').value = user.name;
            return true;
        }

        // Logout function
        function logout() {
            localStorage.removeItem('user');
            window.location.href = '/login';
        }

        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            generateDailySchedule();

            // Teacher ID select logic (only once)
            const teacherIdSelect = document.getElementById('teacherId');
            const teacherNameInput = document.getElementById('teacherNameInput');
            const teacherNames = {
                'T001': 'Dr. John Smith',
                'T002': 'Prof. Sarah Johnson',
                'T003': 'Dr. Michael Brown',
                'T004': 'Prof. Emily Davis',
                'T005': 'Dr. Robert Wilson'
            };
            teacherIdSelect.addEventListener('change', function() {
                teacherNameInput.value = teacherNames[this.value] || '';
            });
            if (teacherIdSelect.value) {
                teacherNameInput.value = teacherNames[teacherIdSelect.value] || '';
            }

            // Handle form submission
            document.getElementById('attendanceForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const formData = new FormData(this);
                const teacherId = teacherIdSelect.value;
                const sessionData = {
                    department: formData.get('department'),
                    className: formData.get('className'),
                    section: formData.get('section'),
                    period: formData.get('period'),
                    attendanceMode: formData.get('attendanceMode'),
                    teacherName: formData.get('teacherName'),
                    teacherId: teacherId,
                    date: new Date().toISOString().split('T')[0]
                };
                if (!sessionData.department || !sessionData.className || !sessionData.section || !sessionData.period || !sessionData.teacherId) {
                    alert('Please fill in all required fields.');
                    return;
                }
                localStorage.setItem('attendanceSession', JSON.stringify(sessionData));
                window.location.href = '/attendance';
            });
        });
    </script>
</body>
</html>