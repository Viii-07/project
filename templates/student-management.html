<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Management - SmartAttend</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: 'hsl(221, 83%, 53%)',
                        'primary-foreground': 'hsl(210, 40%, 98%)',
                        secondary: 'hsl(210, 40%, 96%)',
                        'secondary-foreground': 'hsl(222.2, 84%, 4.9%)',
                        muted: 'hsl(210, 40%, 96%)',
                        'muted-foreground': 'hsl(215.4, 16.3%, 46.9%)',
                        accent: 'hsl(210, 40%, 96%)',
                        'accent-foreground': 'hsl(222.2, 84%, 4.9%)',
                        destructive: 'hsl(0, 84%, 60%)',
                        'destructive-foreground': 'hsl(210, 40%, 98%)',
                        border: 'hsl(214.3, 31.8%, 91.4%)',
                        input: 'hsl(214.3, 31.8%, 91.4%)',
                        ring: 'hsl(221, 83%, 53%)',
                        background: 'hsl(0, 0%, 100%)',
                        foreground: 'hsl(222.2, 84%, 4.9%)',
                        card: 'hsl(0, 0%, 100%)',
                        'card-foreground': 'hsl(222.2, 84%, 4.9%)',
                        success: 'hsl(142, 76%, 36%)',
                        warning: 'hsl(38, 92%, 50%)'
                    },
                    backgroundImage: {
                        'gradient-primary': 'linear-gradient(135deg, hsl(221, 83%, 53%), hsl(221, 83%, 63%))',
                        'gradient-hero': 'linear-gradient(135deg, hsl(221, 83%, 53%) 0%, hsl(221, 83%, 63%) 100%)'
                    },
                    boxShadow: {
                        'elegant': '0 10px 30px -10px hsl(221, 83%, 53%, 0.3)',
                        'card': '0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1)'
                    }
                }
            }
        }
    </script>
</head>
<body class="min-h-screen bg-background">
    <!-- Navigation -->
    <nav class="bg-card border-b shadow-card">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <button onclick="window.location.href='/admin-dashboard'" class="px-4 py-2 border border-border rounded-lg hover:bg-muted transition-colors flex items-center gap-2">
                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                        Back
                    </button>
                    <div>
                        <h1 class="text-xl font-bold text-primary">Student Management</h1>
                        <p class="text-xs text-muted-foreground">Manage student records and information</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <div class="text-right">
                        <p class="font-medium text-foreground" id="adminName">Principal Smith</p>
                        <p class="text-sm text-muted-foreground">Administrator</p>
                    </div>
                    <button onclick="logout()" class="text-muted-foreground hover:text-foreground transition-colors">
                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="flex items-center justify-between mb-8">
            <div>
                <h2 class="text-3xl font-bold text-foreground mb-2">Student Management</h2>
                <p class="text-muted-foreground">Add, edit, and manage student records</p>
            </div>
            <button onclick="openAddStudentModal()" class="bg-gradient-primary text-primary-foreground px-6 py-3 rounded-lg font-semibold shadow-elegant hover:shadow-lg transition-all duration-300 flex items-center gap-2">
                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                </svg>
                Add Student
            </button>
        </div>

        <!-- Filters -->
        <div class="bg-card p-6 rounded-xl shadow-card mb-8">
            <div class="grid md:grid-cols-4 gap-4">
                <select id="filterDepartment" onchange="filterStudents()" class="px-4 py-3 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                    <option value="">All Departments</option>
                    <option value="Computer Science">Computer Science</option>
                    <option value="Mechanical">Mechanical Engineering</option>
                    <option value="Electronics">Electronics & Communication</option>
                    <option value="Civil">Civil Engineering</option>
                </select>
                <select id="filterClass" onchange="filterStudents()" class="px-4 py-3 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                    <option value="">All Classes</option>
                    <option value="1st Year">1st Year</option>
                    <option value="2nd Year">2nd Year</option>
                    <option value="3rd Year">3rd Year</option>
                    <option value="4th Year">4th Year</option>
                </select>
                <select id="filterSection" onchange="filterStudents()" class="px-4 py-3 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                    <option value="">All Sections</option>
                    <option value="A">Section A</option>
                    <option value="B">Section B</option>
                    <option value="C">Section C</option>
                    <option value="D">Section D</option>
                </select>
                <input type="text" id="searchInput" placeholder="Search students..." onkeyup="filterStudents()" class="px-4 py-3 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
            </div>
        </div>

        <!-- Students Table -->
        <div class="bg-card rounded-xl shadow-card overflow-hidden">
            <div class="p-6 border-b border-border">
                <h3 class="text-xl font-bold text-foreground">Student Records</h3>
                <p class="text-muted-foreground">Total students: <span id="totalStudents">0</span></p>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-muted">
                        <tr>
                            <th class="text-left p-4 font-medium text-foreground">Roll Number</th>
                            <th class="text-left p-4 font-medium text-foreground">Name</th>
                            <th class="text-left p-4 font-medium text-foreground">Department</th>
                            <th class="text-left p-4 font-medium text-foreground">Class</th>
                            <th class="text-left p-4 font-medium text-foreground">Section</th>
                            <th class="text-left p-4 font-medium text-foreground">Attendance %</th>
                            <th class="text-left p-4 font-medium text-foreground">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="studentsTableBody">
                        <!-- Students will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Add/Edit Student Modal -->
    <div id="studentModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-card p-8 rounded-xl shadow-card max-w-md w-full mx-4">
            <div class="flex items-center justify-between mb-6">
                <h3 id="modalTitle" class="text-xl font-bold text-foreground">Add New Student</h3>
                <button onclick="closeStudentModal()" class="text-muted-foreground hover:text-foreground">
                    <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <form id="studentForm" class="space-y-4">
                <input type="hidden" id="studentId">
                <div>
                    <label class="block text-sm font-medium text-foreground mb-2">Roll Number</label>
                    <input type="text" id="rollNumber" required class="w-full px-4 py-3 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-foreground mb-2">Full Name</label>
                    <input type="text" id="studentName" required class="w-full px-4 py-3 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-foreground mb-2">Department</label>
                    <select id="department" required class="w-full px-4 py-3 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                        <option value="">Select Department</option>
                        <option value="Computer Science">Computer Science</option>
                        <option value="Mechanical">Mechanical Engineering</option>
                        <option value="Electronics">Electronics & Communication</option>
                        <option value="Civil">Civil Engineering</option>
                    </select>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-foreground mb-2">Class</label>
                        <select id="studentClass" required class="w-full px-4 py-3 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                            <option value="">Select Class</option>
                            <option value="1st Year">1st Year</option>
                            <option value="2nd Year">2nd Year</option>
                            <option value="3rd Year">3rd Year</option>
                            <option value="4th Year">4th Year</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-foreground mb-2">Section</label>
                        <select id="section" required class="w-full px-4 py-3 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                            <option value="">Select Section</option>
                            <option value="A">Section A</option>
                            <option value="B">Section B</option>
                            <option value="C">Section C</option>
                            <option value="D">Section D</option>
                        </select>
                    </div>
                </div>
                <div class="flex gap-4 pt-4">
                    <button type="button" onclick="closeStudentModal()" class="flex-1 px-4 py-3 border border-border rounded-lg hover:bg-muted transition-colors">
                        Cancel
                    </button>
                    <button type="submit" class="flex-1 bg-gradient-primary text-primary-foreground px-4 py-3 rounded-lg font-semibold shadow-elegant hover:shadow-lg transition-all duration-300">
                        Save Student
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="shared-script.js"></script>
    <script>
        let students = [];
        let filteredStudents = [];
        let editingStudentId = null;

        // Generate demo students
        function generateDemoStudents() {
            const departments = ['Computer Science', 'Mechanical', 'Electronics', 'Civil'];
            const classes = ['1st Year', '2nd Year', '3rd Year', '4th Year'];
            const sections = ['A', 'B', 'C', 'D'];
            const names = [
                'Aarav Sharma', 'Vivaan Gupta', 'Aditya Patel', 'Arjun Singh', 'Reyansh Kumar',
                'Priya Agarwal', 'Ananya Joshi', 'Diya Verma', 'Sara Khan', 'Ishita Mehta',
                'Karan Reddy', 'Rohan Nair', 'Siddharth Rao', 'Akash Jain', 'Varun Tiwari',
                'Meera Shah', 'Riya Kapoor', 'Shreya Pandey', 'Kavya Malhotra', 'Nia Bansal'
            ];

            students = [];
            let id = 1;

            departments.forEach(dept => {
                classes.forEach(cls => {
                    sections.forEach(section => {
                        for (let i = 1; i <= 12; i++) {
                            const rollNumber = `${cls.substring(0, 1)}${dept.substring(0, 2).toUpperCase()}${section}${i.toString().padStart(3, '0')}`;
                            students.push({
                                id: id++,
                                rollNumber: rollNumber,
                                name: names[(id - 1) % names.length] + ` ${i}`,
                                department: dept,
                                class: cls,
                                section: section,
                                attendance: Math.floor(Math.random() * 20) + 80 // 80-100%
                            });
                        }
                    });
                });
            });

            filteredStudents = [...students];
        }

        // Render students table
        function renderStudentsTable() {
            const tbody = document.getElementById('studentsTableBody');
            tbody.innerHTML = '';

            filteredStudents.forEach(student => {
                const row = document.createElement('tr');
                row.className = 'border-b border-border hover:bg-muted/50 transition-colors';
                row.innerHTML = `
                    <td class="p-4 font-medium text-foreground">${student.rollNumber}</td>
                    <td class="p-4 text-foreground">${student.name}</td>
                    <td class="p-4 text-muted-foreground">${student.department}</td>
                    <td class="p-4 text-muted-foreground">${student.class}</td>
                    <td class="p-4 text-muted-foreground">${student.section}</td>
                    <td class="p-4">
                        <span class="px-2 py-1 rounded-full text-sm ${
                            student.attendance >= 90 ? 'bg-success/20 text-success' :
                            student.attendance >= 75 ? 'bg-warning/20 text-warning' :
                            'bg-destructive/20 text-destructive'
                        }">
                            ${student.attendance}%
                        </span>
                    </td>
                    <td class="p-4">
                        <div class="flex gap-2">
                            <button onclick="editStudent(${student.id})" class="text-primary hover:text-primary/80 transition-colors">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                </svg>
                            </button>
                            <button onclick="deleteStudent(${student.id})" class="text-destructive hover:text-destructive/80 transition-colors">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });

            document.getElementById('totalStudents').textContent = filteredStudents.length;
        }

        // Filter students
        function filterStudents() {
            const department = document.getElementById('filterDepartment').value;
            const studentClass = document.getElementById('filterClass').value;
            const section = document.getElementById('filterSection').value;
            const search = document.getElementById('searchInput').value.toLowerCase();

            filteredStudents = students.filter(student => {
                return (!department || student.department === department) &&
                       (!studentClass || student.class === studentClass) &&
                       (!section || student.section === section) &&
                       (!search || student.name.toLowerCase().includes(search) || 
                        student.rollNumber.toLowerCase().includes(search));
            });

            renderStudentsTable();
        }

        // Modal functions
        function openAddStudentModal() {
            editingStudentId = null;
            document.getElementById('modalTitle').textContent = 'Add New Student';
            document.getElementById('studentForm').reset();
            document.getElementById('studentModal').classList.remove('hidden');
        }

        function closeStudentModal() {
            document.getElementById('studentModal').classList.add('hidden');
        }

        function editStudent(id) {
            const student = students.find(s => s.id === id);
            if (!student) return;

            editingStudentId = id;
            document.getElementById('modalTitle').textContent = 'Edit Student';
            document.getElementById('studentId').value = student.id;
            document.getElementById('rollNumber').value = student.rollNumber;
            document.getElementById('studentName').value = student.name;
            document.getElementById('department').value = student.department;
            document.getElementById('studentClass').value = student.class;
            document.getElementById('section').value = student.section;
            document.getElementById('studentModal').classList.remove('hidden');
        }

        function deleteStudent(id) {
            if (confirm('Are you sure you want to delete this student?')) {
                students = students.filter(s => s.id !== id);
                filterStudents();
                alert('Student deleted successfully');
            }
        }

        // Handle form submission
        document.getElementById('studentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const studentData = {
                rollNumber: formData.get('rollNumber') || document.getElementById('rollNumber').value,
                name: formData.get('studentName') || document.getElementById('studentName').value,
                department: formData.get('department') || document.getElementById('department').value,
                class: formData.get('studentClass') || document.getElementById('studentClass').value,
                section: formData.get('section') || document.getElementById('section').value,
                attendance: Math.floor(Math.random() * 20) + 80
            };

            if (editingStudentId) {
                // Edit existing student
                const index = students.findIndex(s => s.id === editingStudentId);
                if (index !== -1) {
                    students[index] = { ...students[index], ...studentData };
                    alert('Student updated successfully');
                }
            } else {
                // Add new student
                const newId = Math.max(...students.map(s => s.id)) + 1;
                students.push({ id: newId, ...studentData });
                alert('Student added successfully');
            }

            closeStudentModal();
            filterStudents();
        });

        // Check authentication
        function checkAuth() {
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            if (!user.role || user.role !== 'admin') {
                window.location.href = 'login.html';
                return false;
            }
            document.getElementById('adminName').textContent = user.name;
            return true;
        }

        // Logout function
        function logout() {
            localStorage.removeItem('user');
            window.location.href = 'login.html';
        }

        // Initialize page
        if (checkAuth()) {
            generateDemoStudents();
            renderStudentsTable();
        }
    </script>
</body>
</html>